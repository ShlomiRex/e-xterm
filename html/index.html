<!DOCTYPE html>
<html>

<head>
	<title>e-xterm</title>

	<link rel="stylesheet" href="../css/index.css">
	<link rel="stylesheet" href="../css/electron-tabs.css">

	<link rel="stylesheet" href="../third-party/bootstrap-5.0.0-beta1-dist/css/bootstrap.css">
	<script src="../third-party/bootstrap-5.0.0-beta1-dist/js/bootstrap.min.js"></script>

	<script src="../third-party/split.js/split.min.js"></script>

	<!-- Chrome tabs -->
	<script src="../third-party/draggabilly/dist/draggabilly.pkgd.js"></script>
	<script src="../third-party/chrome-tabs/js/chrome-tabs.js"></script>
	<link rel="stylesheet" href="../third-party/chrome-tabs/css/chrome-tabs.css">

</head>

<body>


	<!--
	<div id="first" style="width: 50%; height: 100%; padding: 5px;">
-->
	<!-- This is example styling for the badges -->
	<!--

		<div class="accordion" id="accordionExample2">
			<div class="accordion-item">
				<h2 class="accordion-header" id="headingOne">
					<button class="accordion-button" type="button" data-bs-toggle="collapse"
						data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
						All Sessions
					</button>
				</h2>
				<div id="collapseTwo" class="accordion-collapse collapse show" aria-labelledby="headingOne"
					data-bs-parent="#accordionExample2">
					<div class="accordion-body">


						<div class="list-group" id="list-tab" role="tablist">
							<a class="list-group-item list-group-item-action active d-flex justify-content-between align-items-center"
								id="list-home-list" data-toggle="list" href="#list-home" role="tab"
								aria-controls="home">
								root@10.0.0.9
								<span class="badge rounded-pill"
									style="background-color:black; color: white;">SSH</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-profile-list" data-toggle="list" href="#list-profile" role="tab"
								aria-controls="profile">
								shlomid R80.40 GW 172.23.13.204
								<span class="badge rounded-pill"
									style="background-color: chartreuse; color: black;">FTP</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-messages-list" data-toggle="list" href="#list-messages" role="tab"
								aria-controls="messages">
								attacker
								<span class="badge rounded-pill"
									style="background-color:yellow; color: black;">SFTP</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-settings-list" data-toggle="list" href="#list-settings" role="tab"
								aria-controls="settings">
								localhost
								<span class="badge rounded-pill"
									style="background-color:darkgreen; color:white;">VNC</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-settings-list" data-toggle="list" href="#list-settings" role="tab"
								aria-controls="settings">
								test@raspberrypi
								<span class="badge rounded-pill"
									style="background-color:springgreen; color:black;">Telnet</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-settings-list" data-toggle="list" href="#list-settings" role="tab"
								aria-controls="settings">
								Windows95
								<span class="badge rounded-pill"
									style="background-color: rgb(0, 164, 239); color: white;">RDP</span>
							</a>
							<a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
								id="list-settings-list" data-toggle="list" href="#list-settings" role="tab"
								aria-controls="settings">
								Ubuntu 20.04
								<span class="badge rounded-pill"
									style="background-color:orangered; color:white">WSL</span>
							</a>
						</div>


					</div>
				</div>
			</div>
		</div>

		-->



	<div id="left-panel" class="split" style="background-color: rgb(230, 230, 230);">
		<div id="bookmarks-container" class="container">
			<a id="btn_newSession" class="btn btn-primary" role="button">
				New session
			</a>


			<div class="accordion" id="accordionExample">
				<div class="accordion-item">
					<h2 class="accordion-header" id="headingOne">
						<button class="accordion-button" type="button" data-bs-toggle="collapse"
							data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
							Bookmarks
						</button>
					</h2>
					<div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
						data-bs-parent="#accordionExample">
						<div class="accordion-body" id="ToPopulate" style="padding: 0px;">
							<div class="list-group" id="SessionsContainer" role="tablist">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="main-panel" class="split">
		<!-- 		
		<div class="etabs-tabgroup">
			<div class="etabs-tabs"></div>
			<div class="etabs-buttons"></div>
		</div>
		<div class="etabs-views"></div> -->

		<div class="chrome-tabs">
			<div class="chrome-tabs-content"></div>
			<div class="chrome-tabs-bottom-bar">
			</div>

		</div>

		<div id="tabs-content">
			<!-- Populated with hidden content and 1 visible content -->
		</div>

		<script>

			var el = document.querySelector('.chrome-tabs');
			const tabs_content = document.getElementById("tabs-content");
			var tabId = 0; // Last id. When new tab, ++. 
			var selectedTabId = null
			var tabs = [] // Queue

			var chromeTabs = new ChromeTabs();
			chromeTabs.init(el);

			el.addEventListener('activeTabChange', ({ detail }) => {
				console.log('Active tab changed', detail.tabEl.id)

				// Hide previous content
				if (selectedTabId) {
					for (var tab of tabs) {
						if (tab["id"] == selectedTabId) {
							console.log("Hiding: ", selectedTabId)
							tab["DOM_content"].style = "display: none;"
							break
						}
					}
				}

				//Show new content
				selectedTabId = detail.tabEl.id
				for (var tab of tabs) {
					if (tab["id"] == selectedTabId) {
						console.log("Showing: ", selectedTabId)
						tab["DOM_content"].style = "display: block;"
						break
					}
				}
			})

			el.addEventListener('tabAdd', ({ detail }) => {
				detail.tabEl.id = "tabEl_" + tabId;
				console.log('Tab added', detail.tabEl.id)

				const content = document.createElement("div");
				content.setAttribute("id", "content_" + tabId);
				content.textContent = "Content with tabId " + tabId
				tabs_content.appendChild(content);

				tabs.push({
					"id": detail.tabEl.id,
					"DOM_tab": detail.tabEl,
					"DOM_content": content
				})

				tabId++;
			})
			el.addEventListener('tabRemove', ({ detail }) => {
				console.log('Tab removed', detail.tabEl.id)

				for (var i in tabs) {
					var t = tabs[i]
					if (t["id"] == detail.tabEl.id) {
						console.log("Removing from array: ", t)
						tabs.splice(i, 1)
						break
					}
				}
			})

			function addTerminalTab() {
				chromeTabs.addTab({
					title: 'Terminal',
					favicon: '../resources/terminal.png'
				});


			}

			addTerminalTab();
			addTerminalTab();
			addTerminalTab();

			//const tabs_content = document.getElementById("tabs-content");
			//tabs_content.appendChild(document.createTextNode("Test 1"));
			//tabs_content.appendChild(document.createTextNode("Test 2"));

		</script>
	</div>

	<script>
		Split(['#left-panel', '#main-panel'],
			{
				sizes: [20, 80],
				gutterSize: 5,

			}
		);
	</script>


	<script>
		window.api.loadscript("../js/index.js");
	</script>

</body>

</html>