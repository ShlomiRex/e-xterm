<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="../third-party/bootstrap-5.0.0-beta1-dist/css/bootstrap.css">
	<script src="../third-party/bootstrap-5.0.0-beta1-dist/js/bootstrap.min.js"></script>
	<title>
		Bookmark Settings
	</title>
</head>

<body class="container">
	<div id="content" style="margin-top: 10px;">
		<div id="hidden_content_SSH">
			<form id="form" onsubmit="submitForm()">
				<div class="accordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button" type="button" data-bs-toggle="collapse"
								data-bs-target="#BasicSettings" aria-expanded="true">
								Basic Settings
							</button>
						</h2>
						<div id="BasicSettings" class="accordion-collapse collapse show"
							data-bs-parent="#BasicSettings">
							<div class="accordion-body">
								<div class="list-group" id="list-tab" role="tablist">
									<div class="row">
										<div class="col">
											<label for="remote_host" class="form-label">
												<span style="color: red;">*</span>
												Remote host:
											</label>
										</div>
										<div class="col">
											<input type="text" class="form-control" id="remote_host"
												title="Host name or IP address" placeholder="Example: pi@raspberrypi"
												required>
										</div>
									</div>

									<div class="row">
										<div class="col">
											<label for="username" class="form-label">
												Username:
											</label>
										</div>
										<div class="col">
											<input type="text" class="form-control" id="username"
												title="Username to use" placeholder="Example: root">
										</div>
									</div>

									<div class="row">
										<div class="col">
											<label for="port" class="form-label">
												<span style="color: red;">*</span>
												Port:
											</label>
										</div>
										<div class="col">
											<input type="number" class="form-control" id="port" title="Port to use"
												value="22" required>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="accordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button" type="button" data-bs-toggle="collapse"
								data-bs-target="#AdvancedSettings" aria-expanded="true">
								Advanced SSH Settings
							</button>
						</h2>
						<div id="AdvancedSettings" class="accordion-collapse collapse show"
							data-bs-parent="#AdvancedSettings">
							<div class="accordion-body">
								<div class="list-group" id="list-tab" role="tablist">
									<div class="row">
										<div class="col"
											title="X11-Forwarding allows executing a program remotly through SSH and the GUI will run locally">
											<input class="form-check-input" type="checkbox" value="" id="x11_forwarding"
												checked />
											<label class="form-check-label" for="x11_forwarding">
												X11-Forwarding
											</label>
										</div>
										<div class="col"
											title="Compression is useful when the connection speed is slow">
											<input class="form-check-input" type="checkbox" value="" id="compression"
												checked />
											<label class="form-check-label" for="compression">
												Compression
											</label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="accordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button" type="button" data-bs-toggle="collapse"
								data-bs-target="#BookmarkSettings" aria-expanded="true">
								Bookmark Settings
							</button>
						</h2>
						<div id="BookmarkSettings" class="accordion-collapse collapse show"
							data-bs-parent="#BookmarkSettings">
							<div class="accordion-body">
								<div class="list-group" id="list-tab" role="tablist">
									<div class="row">
										<div class="col">
											<label for="session_name" class="form-label">
												Session name:
											</label>
										</div>
										<div class="col">
											<input type="text" class="form-control" id="session_name"
												title="Give meaningful name" placeholder="Example: Ubuntu 20.04 VM">
										</div>
									</div>

									<div class="row">
										<div class="col">
											<label for="session_description" class="form-label">
												Session description:
											</label>
										</div>
										<div class="col">
											<textarea class="form-control" id="session_description" rows="3"
												title="Something to describe this session"
												placeholder="Description..."></textarea>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<br>
				<div>
					<button type="submit" class="btn btn-primary">Apply</button>
					<a id="cancel" name="cancel" class="btn btn-outline-danger" onclick="cancel()">Cancel</a>

					<button onclick="deleteClicked()" class="btn btn-danger" style="position: relative;float: right;"
						title="Delete this bookmark" type="button">Delete</button>
				</div>
			</form>
		</div>
	</div>

</body>

<script>
	const { ipcRenderer } = require('electron')


	let bookmarkId = undefined;

	//This parameter is set after DOM is loaded from main process.
	let session = undefined;

	const e_remote_host = document.getElementById("remote_host");
	const e_username = document.getElementById("username");
	const e_port = document.getElementById("port");
	const e_x11_forwarding = document.getElementById("x11_forwarding");
	const e_compression = document.getElementById("compression");
	const e_session_name = document.getElementById("session_name");
	const e_session_description = document.getElementById("session_description");


	function updateGUI(session) {
		//Update the GUI to match the given session (set GUI elements to match the session settings)
		const protocol = session.protocol;
		const remote_host = session.remote_host;
		const username = session.username;
		const port = session.port;
		const session_name = session.session_name;
		const session_description = session.session_description;
		const x11_forwarding = session.x11_forwarding;
		const compression = session.compression;

		console.log(protocol, remote_host, username, port, session_name, session_description, x11_forwarding, compression)

		e_remote_host.value = remote_host;
		e_username.value = username;
		e_port.value = port;

		e_session_name.value = session_name;
		e_session_description.value = session_description;

		e_x11_forwarding.checked = x11_forwarding;
		e_compression.checked = compression;
	}

	ipcRenderer.once("get-args", (ev, _bookmarkId, _session) => {
		console.log("Got bookmarkId and session:", _bookmarkId, _session)
		bookmarkId = _bookmarkId;
		session = _session;

		updateGUI(session);
	});

	function cancel() {
		window.close()
	}

	function deleteClicked() {
		ipcRenderer.send("DeleteBookmark", bookmarkId)
		close()
	}

	function submitForm() {
		console.log("Submit form")

		let json = {};
		json["protocol"] = "SSH";
		json["remote_host"] = e_remote_host.value;
		json["username"] = e_username.value;
		json["port"] = e_port.value;

		json["x11_forwarding"] = e_x11_forwarding.checked;
		json["compression"] = e_compression.checked;

		json["session_name"] = e_session_name.value;
		json["session_description"] = e_session_description.value;


		//Update bookmark
		ipcRenderer.send("Renderer_BookmarksUI_UpdateBookmark", json)

		window.close()
	}
</script>

</html>