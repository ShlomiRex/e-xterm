<!DOCTYPE html>
<html>

<head>
	<title>Login</title>
	<link rel="stylesheet" href="../third-party/bootstrap-5.0.0-beta1-dist/css/bootstrap.css">
	<script src="../third-party/bootstrap-5.0.0-beta1-dist/js/bootstrap.min.js"></script>

</head>

<body>

	<div class="container">
		<div id="username_container">
			Username:
			<input id="username" type="text" class="form-control">	
		</div>

		
		<div id="pass_text_container">
			Password:
		</div>
		<input id="pass" type="password" class="form-control">

		<button type="submit" class="btn btn-primary" onclick="submit()">OK</button>
		<button class="btn btn-outline-danger" onclick="closeWindow()">Cancel</button>
	</div>

	<script>
		const { ipcRenderer, remote } = require('electron')
		var window = remote.getCurrentWindow();


		let username_input = document.getElementById("username");
		let pass_input = document.getElementById("pass");
		let pass_text_container = document.getElementById("pass_text_container")

		let username_required = undefined;
		let passphrase_required = undefined

		ipcRenderer.once("get-args", (ev, _username_required, _passphrase_required) => {
			console.log("get-args, ask for username? ", _username_required)

			username_required = _username_required
			passphrase_required = _passphrase_required

			if(! username_required) {
				pass_input.focus();

				document.getElementById("username_container").remove();
			} else {
				username_input.focus();
			}

			if(passphrase_required) {
				pass_text_container.textContent = "Private key passphrase:"
			}
		});

		pass_input.addEventListener("keyup", (ev) => {
			console.log("Key pressed:", ev.keyCode)
			if(ev.keyCode == 13) {
				//Enter pressed

				//event.preventDefault();
				submit();
			}
		});

		function submit() {
			console.log("Submit");
			let username = null;
			const password = pass_input.value;

			if(username_required) {
				username = username_input.value;
			}
			ipcRenderer.send("LoginWindowResult", username, password);
			
			closeWindow()
		}

		function closeWindow() {
			window.close();
		}
	</script>
</body>

</html>